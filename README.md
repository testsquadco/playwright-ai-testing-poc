# Playwright Agents Demo (v1.56)

This repo demonstrates an end-to-end AI-assisted testing workflow in VS Code using Playwright Agents:

- Planner â†’ plan tests in Markdown
- Generator â†’ generate Playwright tests
- Healer â†’ auto-repair failing tests and produce a patch

Target app: https://demo-saas.bugbug.io/

## Prerequisites
- Node.js 18+
- VS Code (latest)
- Playwright browsers installed
  - `npx playwright install`

## Project Structure
- `.github/chatmodes/` â€” Agent chatmodes
  - `ğŸ­ planner.chatmode.md`
  - `ğŸ­ generator.chatmode.md`
  - `ğŸ­ healer.chatmode.md`
- `.vscode/mcp.json` â€” MCP server config (used by agents)
- `specs/saas-demo-test-plan.md` â€” Markdown test plan (generated by Planner)
- `seed.spec.ts` â€” Seed test used by agents when planning/generating
- `tests/` â€” Playwright TypeScript tests (generated + curated)
- `playwright.config.ts` â€” Test config with baseURL, retries, reporters
- `healer-fix.diff` â€” Unified diff patch produced by Healer (not applied)

## Install & Run (CLI)
1) Install dependencies and browsers
```
npm i
npx playwright install
```

2) Run tests
```
npm test -s
```

3) UI/Headed modes
```
npm run test:ui
npm run test:headed
```

4) Reports & Traces
```
npm run show-report
# To view a specific trace from the report output
npx playwright show-trace test-results/<path-to-trace>.zip
```

## VS Code Agent Workflow

### 1) Initialize Agents (already done here)
If starting from scratch in a new folder:
```
npx playwright init-agents --loop=vscode
```
This creates the chatmodes and seed file.

### 2) Planner: Generate the Test Plan
- Open this folder in VS Code.
- Open VS Code Chat and select â€œPlaywright Planner Agentâ€.
- Example prompt:
  - "Explore https://demo-saas.bugbug.io and create a comprehensive test plan. Save to specs/saas-demo-test-plan.md. Use seed from seed.spec.ts."

Planner will browse with tool access and write a Markdown test plan at `specs/saas-demo-test-plan.md`.

### 3) Generator: Create Tests from the Plan
- In VS Code Chat, select â€œPlaywright Generator Agentâ€.
- Example prompt:
  - "Generate Playwright TypeScript tests from specs/saas-demo-test-plan.md. Use seed from seed.spec.ts. Save tests under tests/ with feature-based filenames."

Generator will produce `.spec.ts` files in `tests/`.

### 4) Simulate a Real-World Failure
- Open `tests/navigation.spec.ts`.
- Intentionally break a selector (example):
  - Change a working click, e.g. `page.locator('form').getByRole('link', { name: 'Sign up' }).click()`
  - To a failing one: `page.getByText('Register').click()`
- Run the suite to capture the failure and produce trace & screenshots:
```
npm test -s
```

### 5) Healer: Analyze and Propose a Patch (Not Applied)
- In VS Code Chat, select â€œPlaywright Healer Agentâ€.
- Prompt example:
  - "Analyze the failing test(s) in tests/navigation.spec.ts using the latest artifacts in test-results/. Generate a Git-style unified diff patch that fixes the failure (do not apply). Include a short explanation as commented lines ('# ...') followed by a single *** Begin Patch block that updates tests/navigation.spec.ts."
- Copy the agentâ€™s output and save to `healer-fix.diff` (do not apply).

Note: This repository already includes a sample `healer-fix.diff` produced for the `Register` vs `Sign up` failure scenario.

### 6) (Optional) Apply the Patch and Re-Run
If you decide to apply the healerâ€™s patch, make the edits suggested in `healer-fix.diff` and run:
```
npm test -s
```

## Testing Best Practices Used
- Accessible, role-based selectors (prefer `getByRole` over raw CSS).
- Scoping to containers (e.g., `locator('form')`) to avoid strict mode violations when multiple elements share the same name.
- Avoid brittle heading assertions; verify URLs + stable controls (e.g., "Continue with Email") instead.
- Use traces/screenshots on retry for debugging.

## Troubleshooting
- Ambiguous selectors (strict mode violations):
  - Use `.first()` or scope with `locator('form')` / specific containers.
- Elements missing due to text changes:
  - Prefer role/label-based queries; rely on baseURL & URL assertions.
- Network flakes:
  - Re-run with `--headed` and review traces.

## NPM Scripts
- `test` â†’ `playwright test`
- `test:ui` â†’ `playwright test --ui`
- `test:headed` â†’ `playwright test --headed`
- `codegen` â†’ `playwright codegen`
- `show-report` â†’ `playwright show-report`
